<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Whist Protocol: Region Allocator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Whist Protocol
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__region__allocator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Region Allocator<div class="ingroups"><a class="el" href="group__memory.html">Memory</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Region allocator wrapping mmap()/VirtualAlloc().  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac5cb37b0580474e152f2450c34979720"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__region__allocator.html#gac5cb37b0580474e152f2450c34979720">allocate_region</a> (size_t region_size)</td></tr>
<tr class="memdesc:gac5cb37b0580474e152f2450c34979720"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a region of memory, of the requested size.  <a href="group__region__allocator.html#gac5cb37b0580474e152f2450c34979720">More...</a><br /></td></tr>
<tr class="separator:gac5cb37b0580474e152f2450c34979720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3b6692eaffcf106ffdecddfb77e8dbe9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__region__allocator.html#ga3b6692eaffcf106ffdecddfb77e8dbe9">mark_unused_region</a> (void *region)</td></tr>
<tr class="memdesc:ga3b6692eaffcf106ffdecddfb77e8dbe9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the region as unused (for now).  <a href="group__region__allocator.html#ga3b6692eaffcf106ffdecddfb77e8dbe9">More...</a><br /></td></tr>
<tr class="separator:ga3b6692eaffcf106ffdecddfb77e8dbe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad91ad1707c56178b66bd39a9b1b1e8a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__region__allocator.html#gad91ad1707c56178b66bd39a9b1b1e8a7">mark_used_region</a> (void *region)</td></tr>
<tr class="memdesc:gad91ad1707c56178b66bd39a9b1b1e8a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the region as used again.  <a href="group__region__allocator.html#gad91ad1707c56178b66bd39a9b1b1e8a7">More...</a><br /></td></tr>
<tr class="separator:gad91ad1707c56178b66bd39a9b1b1e8a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga38cef2a2f287ce784dcd824293e4ebba"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__region__allocator.html#ga38cef2a2f287ce784dcd824293e4ebba">realloc_region</a> (void *region, size_t new_region_size)</td></tr>
<tr class="memdesc:ga38cef2a2f287ce784dcd824293e4ebba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resize the memory region.  <a href="group__region__allocator.html#ga38cef2a2f287ce784dcd824293e4ebba">More...</a><br /></td></tr>
<tr class="separator:ga38cef2a2f287ce784dcd824293e4ebba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82c0c0ab6aa54efc85fb5cdc1ea37e1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__region__allocator.html#ga82c0c0ab6aa54efc85fb5cdc1ea37e1f">deallocate_region</a> (void *region)</td></tr>
<tr class="memdesc:ga82c0c0ab6aa54efc85fb5cdc1ea37e1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give the region back to the OS.  <a href="group__region__allocator.html#ga82c0c0ab6aa54efc85fb5cdc1ea37e1f">More...</a><br /></td></tr>
<tr class="separator:ga82c0c0ab6aa54efc85fb5cdc1ea37e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Region allocator wrapping mmap()/VirtualAlloc(). </p>
<p>Note: All of these functions are safe, and will FATAL_ERROR on failure</p>
<p>This is a thin wrapper around mmap/VirtualAlloc, and will give us fine-grained control over regions of memory and whether or not the OS will allocate actual pages of RAM for us. (Pages are usually size 4096, but are in-general OS-defined)</p>
<p>This gives us fine-grained control over the "reported memory usage", which represents pages of RAM that we demand must be allocated, and must not be written-to/read-from by any other processes. This is what controls when the OS is "out of RAM", and what is reported by the OS's "Task Manager".</p>
<p>The OS by-default uses lazy allocation. So we won't actually use RAM until we read or write to a page allocated by allocate_region. All fresh pages we read from will be 0-ed out first</p>
<p>Once we read/write to a page, that page becomes allocated in RAM. If you're done using it, and you want to tell the OS that the data in the region isn't important to you anymore, call the <code>mark_unused_region</code> function. That will decrease our reported memory usage by the size of the region. However, the OS won't actually take those pages from us until it's low on RAM.</p>
<p>If we want to tell the OS that the region is important to us again, call <code>mark_used_region</code>. Just like allocate_region, this won't actually increase reported memory usage, until we read/write to those pages. However, our pages will usually be left exactly as they were prior to <code>mark_unused_region</code>. They'll only be zero-ed out if the OS needed those pages in the meantime. This is much more efficient than having it be zero-ed out every time, it'll only be zero-ed out if it was actually necessary to zero it out.</p>
<p>If we want to completely give the region back to the OS, call <code>deallocate_region</code>, and the RAM + address space will be freed. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac5cb37b0580474e152f2450c34979720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac5cb37b0580474e152f2450c34979720">&#9670;&nbsp;</a></span>allocate_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* allocate_region </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>region_size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a region of memory, of the requested size. </p>
<p>This region will be allocated independently of the malloc heap or any block allocator. Will be zero-initialized.</p>
<p>This will only increase reported memory usage, once the pages are actually read or written to</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">region_size</td><td>The size of the region to create</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new region of memory </dd></dl>

</div>
</div>
<a id="ga82c0c0ab6aa54efc85fb5cdc1ea37e1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga82c0c0ab6aa54efc85fb5cdc1ea37e1f">&#9670;&nbsp;</a></span>deallocate_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void deallocate_region </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>region</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Give the region back to the OS. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">region</td><td>The region to deallocate </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga3b6692eaffcf106ffdecddfb77e8dbe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3b6692eaffcf106ffdecddfb77e8dbe9">&#9670;&nbsp;</a></span>mark_unused_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mark_unused_region </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>region</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Marks the region as unused (for now). </p>
<p>This will let other processes use it if they desire.</p>
<p>This will decrease the reported memory usage, by the size of the region that was used</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">region</td><td>The region to mark as unused </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gad91ad1707c56178b66bd39a9b1b1e8a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad91ad1707c56178b66bd39a9b1b1e8a7">&#9670;&nbsp;</a></span>mark_used_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mark_used_region </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>region</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Marks the region as used again. </p>
<p>This will grab new memory regions from the OS, only give other processes have taken the memory while it was unused</p>
<p>This will only increase the reported memory usage, once the pages are used</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">region</td><td>The region to mark as used now </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga38cef2a2f287ce784dcd824293e4ebba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga38cef2a2f287ce784dcd824293e4ebba">&#9670;&nbsp;</a></span>realloc_region()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* realloc_region </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>region</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_region_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resize the memory region. </p>
<pre class="fragment">                            This will try to simply grow the region,
                            but if it can't, it will allocate a new region
                            and copy everything over
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">region</td><td>The region to resize</td></tr>
    <tr><td class="paramname">new_region_size</td><td>The new size of the region</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new pointer to the region (Will be different from the given region, if an allocation + copy was necessary) </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
