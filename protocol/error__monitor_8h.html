<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fractal Protocol: fractal/logging/error_monitor.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fractal Protocol
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('error__monitor_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">error_monitor.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains the functions to configure and report breadcrumbs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="fractal_8h_source.html">fractal/core/fractal.h</a>&gt;</code><br />
</div>
<p><a href="error__monitor_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5f24be79dfc9dd371d5dd40856a59a85"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#a5f24be79dfc9dd371d5dd40856a59a85">error_monitor_set_environment</a> (char *environment)</td></tr>
<tr class="memdesc:a5f24be79dfc9dd371d5dd40856a59a85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the error monitor to use the provided environment.  <a href="error__monitor_8h.html#a5f24be79dfc9dd371d5dd40856a59a85">More...</a><br /></td></tr>
<tr class="separator:a5f24be79dfc9dd371d5dd40856a59a85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac79b8627dca780eb8e77b089904e9720"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#ac79b8627dca780eb8e77b089904e9720">error_monitor_set_username</a> (char *username)</td></tr>
<tr class="memdesc:ac79b8627dca780eb8e77b089904e9720"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the username tag for error monitor reports.  <a href="error__monitor_8h.html#ac79b8627dca780eb8e77b089904e9720">More...</a><br /></td></tr>
<tr class="separator:ac79b8627dca780eb8e77b089904e9720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a720d85cec99cf15e5b82801d081e32a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#a720d85cec99cf15e5b82801d081e32a3">error_monitor_set_connection_id</a> (int id)</td></tr>
<tr class="memdesc:a720d85cec99cf15e5b82801d081e32a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the connection id tag for error monitor reports.  <a href="error__monitor_8h.html#a720d85cec99cf15e5b82801d081e32a3">More...</a><br /></td></tr>
<tr class="separator:a720d85cec99cf15e5b82801d081e32a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34f41217150d754fbef4f32e948748e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3">error_monitor_initialize</a> (bool is_client)</td></tr>
<tr class="memdesc:a34f41217150d754fbef4f32e948748e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the error monitor.  <a href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3">More...</a><br /></td></tr>
<tr class="separator:a34f41217150d754fbef4f32e948748e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5509b96231f401ea288eec740f85eed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#ab5509b96231f401ea288eec740f85eed">error_monitor_shutdown</a> ()</td></tr>
<tr class="memdesc:ab5509b96231f401ea288eec740f85eed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shuts down the error monitor.  <a href="error__monitor_8h.html#ab5509b96231f401ea288eec740f85eed">More...</a><br /></td></tr>
<tr class="separator:ab5509b96231f401ea288eec740f85eed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6769fc9b7fd37709668f93f23735132"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#aa6769fc9b7fd37709668f93f23735132">error_monitor_log_breadcrumb</a> (const char *tag, const char *message)</td></tr>
<tr class="memdesc:aa6769fc9b7fd37709668f93f23735132"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logs a breadcrumb to the error monitor.  <a href="error__monitor_8h.html#aa6769fc9b7fd37709668f93f23735132">More...</a><br /></td></tr>
<tr class="separator:aa6769fc9b7fd37709668f93f23735132"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd75d2bc78de7ef5c6d782337e3f96a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="error__monitor_8h.html#afd75d2bc78de7ef5c6d782337e3f96a4">error_monitor_log_error</a> (const char *message)</td></tr>
<tr class="memdesc:afd75d2bc78de7ef5c6d782337e3f96a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logs an error event to the error monitor.  <a href="error__monitor_8h.html#afd75d2bc78de7ef5c6d782337e3f96a4">More...</a><br /></td></tr>
<tr class="separator:afd75d2bc78de7ef5c6d782337e3f96a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains the functions to configure and report breadcrumbs. </p>
<p>Copyright Fractal Computers, Inc. 2021</p>
<h1><a class="anchor" id="autotoc_md153"></a>
and error events to tools such as Sentry.</h1>
<h1><a class="anchor" id="autotoc_md154"></a>
Usage</h1>
<p>The error monitor needs to have an environment configured before it can be started up. This environment should be development/staging/production, and is passed in as a command-line parameter. Once the value is known, we may call <code><a class="el" href="error__monitor_8h.html#a5f24be79dfc9dd371d5dd40856a59a85" title="Configures the error monitor to use the provided environment.">error_monitor_set_environment()</a></code> to configure it.</p>
<p>If no environment is set, the error monitor will fail to initialize. This is because we don't want it to complain in personal setups and manual connections when developing, but it's important to note the side-effect that we will not report to the error monitoring service if environment isn't passed in.</p>
<p>To initialize the error monitor, we call <code><a class="el" href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3" title="Initializes the error monitor.">error_monitor_initialize()</a></code>. After doing so, we can configure the error logging metadata with <code><a class="el" href="error__monitor_8h.html#ac79b8627dca780eb8e77b089904e9720" title="Configures the username tag for error monitor reports.">error_monitor_set_username()</a></code> and <code><a class="el" href="error__monitor_8h.html#a720d85cec99cf15e5b82801d081e32a3" title="Configures the connection id tag for error monitor reports.">error_monitor_set_connection_id()</a></code>.</p>
<p>At this point, calling <code><a class="el" href="error__monitor_8h.html#aa6769fc9b7fd37709668f93f23735132" title="Logs a breadcrumb to the error monitor.">error_monitor_log_breadcrumb()</a></code> and <code><a class="el" href="error__monitor_8h.html#afd75d2bc78de7ef5c6d782337e3f96a4" title="Logs an error event to the error monitor.">error_monitor_log_error()</a></code> will report a trace of non-error events and report a detailed breakdown for error-level events to the error monitor service, respectively. Importantly, <em>you should almost never be calling this function by itself</em>. Instead, simply use the <code>LOG_*()</code> functions from <a class="el" href="logging_8h.html" title="This file contains the logging macros and utils to send Winlogon.">logging.h</a>, which will automatically send error monitor breadcrumbs and error reports as needed.</p>
<p>Because of this integration with our logging setup, we run into race conditions in <code><a class="el" href="error__monitor_8h.html#ab5509b96231f401ea288eec740f85eed" title="Shuts down the error monitor.">error_monitor_shutdown()</a></code>, which may cause us to fail to report our last few breadcrumbs and error events. In order to avoid this, we must call <code><a class="el" href="error__monitor_8h.html#ab5509b96231f401ea288eec740f85eed" title="Shuts down the error monitor.">error_monitor_shutdown()</a></code> after calling <code><a class="el" href="logging_8c.html#aa702fa9ec966709ebb51bef79be7b33e" title="Destroy the logger object.">destroy_logger()</a></code>, to allow for any pending error monitor log calls to be handled. Eventually, we should set up a more robust solution for synchronizing these calls. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a34f41217150d754fbef4f32e948748e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34f41217150d754fbef4f32e948748e3">&#9670;&nbsp;</a></span>error_monitor_initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_initialize </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the error monitor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">is_client</td><td>True if this is the client protocol, else false.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This will do nothing if the environment has not already been set. </dd></dl>

</div>
</div>
<a id="aa6769fc9b7fd37709668f93f23735132"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6769fc9b7fd37709668f93f23735132">&#9670;&nbsp;</a></span>error_monitor_log_breadcrumb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_log_breadcrumb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logs a breadcrumb to the error monitor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tag</td><td>The level of the breadcrumb; for example, "WARNING" or "INFO".</td></tr>
    <tr><td class="paramname">message</td><td>The message associated with the breadcrumb.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This is automatically called from the <code>LOG_*</code> functions from <a class="el" href="logging_8h.html" title="This file contains the logging macros and utils to send Winlogon.">logging.h</a>, and should almost never be called alone. Because of this, <code>LOG_*</code> functions should NEVER be called from here, or we risk entering an infinite recursion loop. </dd></dl>

</div>
</div>
<a id="afd75d2bc78de7ef5c6d782337e3f96a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd75d2bc78de7ef5c6d782337e3f96a4">&#9670;&nbsp;</a></span>error_monitor_log_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_log_error </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logs an error event to the error monitor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The message associated with the error event.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This is automatically called from the <code>LOG_*</code> functions from <a class="el" href="logging_8h.html" title="This file contains the logging macros and utils to send Winlogon.">logging.h</a>, and should almost never be called alone. Because of this, <code>LOG_*</code> functions should NEVER be called from here, or we risk entering an infinite recursion loop. </dd></dl>

</div>
</div>
<a id="a720d85cec99cf15e5b82801d081e32a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a720d85cec99cf15e5b82801d081e32a3">&#9670;&nbsp;</a></span>error_monitor_set_connection_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_set_connection_id </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the connection id tag for error monitor reports. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>The connection id to set. Setting -1 will set the connection id to "waiting".</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This should only be called after calling <code><a class="el" href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3" title="Initializes the error monitor.">error_monitor_initialize()</a></code>. </dd></dl>

</div>
</div>
<a id="a5f24be79dfc9dd371d5dd40856a59a85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f24be79dfc9dd371d5dd40856a59a85">&#9670;&nbsp;</a></span>error_monitor_set_environment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_set_environment </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>environment</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the error monitor to use the provided environment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">environment</td><td>The environment to set: should be one of development/staging/production.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This should only be called before calling <code><a class="el" href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3" title="Initializes the error monitor.">error_monitor_initialize()</a></code>. </dd></dl>

</div>
</div>
<a id="ac79b8627dca780eb8e77b089904e9720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac79b8627dca780eb8e77b089904e9720">&#9670;&nbsp;</a></span>error_monitor_set_username()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_set_username </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>username</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the username tag for error monitor reports. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">username</td><td>The username to set. Setting NULL or "None" will unset the username instead.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This should only be called after calling <code><a class="el" href="error__monitor_8h.html#a34f41217150d754fbef4f32e948748e3" title="Initializes the error monitor.">error_monitor_initialize()</a></code>. </dd></dl>

</div>
</div>
<a id="ab5509b96231f401ea288eec740f85eed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5509b96231f401ea288eec740f85eed">&#9670;&nbsp;</a></span>error_monitor_shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void error_monitor_shutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shuts down the error monitor. </p>
<dl class="section note"><dt>Note</dt><dd>This should only be called after calling <a class="el" href="logging_8h.html" title="This file contains the logging macros and utils to send Winlogon.">logging.h</a>'s <code><a class="el" href="logging_8c.html#aa702fa9ec966709ebb51bef79be7b33e" title="Destroy the logger object.">destroy_logger()</a></code>. See the "Usage" section above for details. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2993051f07ff2cebc55eadc6068be547.html">fractal</a></li><li class="navelem"><a class="el" href="dir_128beccb94ee56ef1e878679d37b9b34.html">logging</a></li><li class="navelem"><a class="el" href="error__monitor_8h.html">error_monitor.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
