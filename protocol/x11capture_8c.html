<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Whist Protocol: whist/video/capture/x11capture.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Whist Protocol
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('x11capture_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">x11capture.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Copyright (c) 2021-2022 Whist Technologies, Inc.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="capture_8h_source.html">capture.h</a>&quot;</code><br />
<code>#include &lt;X11/extensions/Xdamage.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/shm.h&gt;</code><br />
<code>#include &lt;X11/Xutil.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4b72082f8dd40fefd41fe8a3a721eba0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x11capture_8c.html#a4b72082f8dd40fefd41fe8a3a721eba0">handler</a> (Display *d, XErrorEvent *a)</td></tr>
<tr class="separator:a4b72082f8dd40fefd41fe8a3a721eba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8726a7b905e966e3da05147cd168bdf1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x11capture_8c.html#a8726a7b905e966e3da05147cd168bdf1">create_x11_capture_device</a> (uint32_t width, uint32_t height, uint32_t dpi)</td></tr>
<tr class="memdesc:a8726a7b905e966e3da05147cd168bdf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a device for capturing via X11 with the specified width, height, and DPI.  <a href="x11capture_8c.html#a8726a7b905e966e3da05147cd168bdf1">More...</a><br /></td></tr>
<tr class="separator:a8726a7b905e966e3da05147cd168bdf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af248ecd1f0808e45436a7be65f238b8b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x11capture_8c.html#af248ecd1f0808e45436a7be65f238b8b">reconfigure_x11_capture_device</a> (<a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *device, uint32_t width, uint32_t height, uint32_t dpi)</td></tr>
<tr class="separator:af248ecd1f0808e45436a7be65f238b8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14556ad435b66ddf880360717fbc0ba2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x11capture_8c.html#a14556ad435b66ddf880360717fbc0ba2">x11_capture_screen</a> (<a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *device)</td></tr>
<tr class="memdesc:a14556ad435b66ddf880360717fbc0ba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capture the screen with given device.  <a href="x11capture_8c.html#a14556ad435b66ddf880360717fbc0ba2">More...</a><br /></td></tr>
<tr class="separator:a14556ad435b66ddf880360717fbc0ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c091e3659e09d9e8968dab45486f057"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x11capture_8c.html#a8c091e3659e09d9e8968dab45486f057">destroy_x11_capture_device</a> (<a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *device)</td></tr>
<tr class="memdesc:a8c091e3659e09d9e8968dab45486f057"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the given <a class="el" href="structX11CaptureDevice.html" title="Struct to handle using X11 for capturing the screen.">X11CaptureDevice</a> and free it.  <a href="x11capture_8c.html#a8c091e3659e09d9e8968dab45486f057">More...</a><br /></td></tr>
<tr class="separator:a8c091e3659e09d9e8968dab45486f057"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Copyright (c) 2021-2022 Whist Technologies, Inc. </p>
<p>This file contains the code to create a capture device and use it to capture the screen on </p>
<h1><a class="anchor" id="autotoc_md238"></a>
Linux.</h1>
<h1><a class="anchor" id="autotoc_md239"></a>
Usage</h1>
<p>We first try to create a capture device that uses Nvidia's FBC SDK for capturing frames. This capture device must be paired with an Nvidia encoder. If those fail, we fall back to using X11's API to create a capture device, which captures on the CPU, and encode using FFmpeg instead. See <a class="el" href="encode_8h.html" title="Copyright (c) 2021-2022 Whist Technologies, Inc.">codec/encode.h</a> for more details on encoding. The type of capture device currently in use is indicated in active_capture_device. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8726a7b905e966e3da05147cd168bdf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8726a7b905e966e3da05147cd168bdf1">&#9670;&nbsp;</a></span>create_x11_capture_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a>* create_x11_capture_device </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>dpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a device for capturing via X11 with the specified width, height, and DPI. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">width</td><td>The desired width of the device </td></tr>
    <tr><td class="paramname">height</td><td>The desired height of the device </td></tr>
    <tr><td class="paramname">dpi</td><td>The desired DPI of the device</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the newly created <a class="el" href="structX11CaptureDevice.html" title="Struct to handle using X11 for capturing the screen.">X11CaptureDevice</a> </dd></dl>

</div>
</div>
<a id="a8c091e3659e09d9e8968dab45486f057"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c091e3659e09d9e8968dab45486f057">&#9670;&nbsp;</a></span>destroy_x11_capture_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy_x11_capture_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *&#160;</td>
          <td class="paramname"><em>device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy the given <a class="el" href="structX11CaptureDevice.html" title="Struct to handle using X11 for capturing the screen.">X11CaptureDevice</a> and free it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>Device to destroy </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4b72082f8dd40fefd41fe8a3a721eba0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b72082f8dd40fefd41fe8a3a721eba0">&#9670;&nbsp;</a></span>handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handler </td>
          <td>(</td>
          <td class="paramtype">Display *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XErrorEvent *&#160;</td>
          <td class="paramname"><em>a</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af248ecd1f0808e45436a7be65f238b8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af248ecd1f0808e45436a7be65f238b8b">&#9670;&nbsp;</a></span>reconfigure_x11_capture_device()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool reconfigure_x11_capture_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>dpi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a14556ad435b66ddf880360717fbc0ba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14556ad435b66ddf880360717fbc0ba2">&#9670;&nbsp;</a></span>x11_capture_screen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int x11_capture_screen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structX11CaptureDevice.html">X11CaptureDevice</a> *&#160;</td>
          <td class="paramname"><em>device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capture the screen with given device. </p>
<p>Afterwards, the frame capture is stored in frame_data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>Device to use for screen captures</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2163314886daa89b67d58b0e72b2c23f.html">whist</a></li><li class="navelem"><a class="el" href="dir_91458d29fc8ea5e0d5bbd615c495719c.html">video</a></li><li class="navelem"><a class="el" href="dir_369deebd5c9d093f21a4a357fb5dec2d.html">capture</a></li><li class="navelem"><a class="el" href="x11capture_8c.html">x11capture.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
