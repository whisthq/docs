<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>metrics - Whist Backend Services</title>

<link type="text/css" rel="stylesheet" href="https://docs.whist.com/backend/services//lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="https://docs.whist.com/backend/services//lib/godoc/jquery.js" defer></script>




<script>var goVersion = "go1.17.7";</script>
<script src="https://docs.whist.com/backend/services//lib/godoc/godocs.js" defer></script>

</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="https:/docs.whist.com/backend/services/pkg/github.com/whisthq/whist/backend/services/">Whist Backend Services | Autogenerated from a5d64a8</a></div>
<div class="top-heading" id="heading-narrow"><a href="https:/docs.whist.com/backend/services/pkg/github.com/whisthq/whist/backend/services/">Whist Backend Services</a></div>
<a href="#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package metrics
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/whisthq/whist/backend/services/host-service/metrics"</code></dd>
			</dl>
			<dl>
			<dd><a href="#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
This package is responsible for handling GPU-related functions on Linux, like
collecting metrics. Note that it assumes we are using an NVIDIA GPU, and that
this package will not work on non-NVIDIA GPUs, since we use NVML for collecting
metrics. The metrics get reported to our logging system the same way we report
other metrics, using the `metrics.go` package.
</p>
<p>
Package metrics is responsible for computing metrics about the instance during
host-service runtime. This includes metrics about total load, CPU usage, etc.
</p>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="#Add">func Add(metric string, delta int64)</a></dd>
			
				
				<dd><a href="#Close">func Close()</a></dd>
			
				
				<dd><a href="#Increment">func Increment(metric string)</a></dd>
			
			
				
				<dd><a href="#RuntimeMetrics">type RuntimeMetrics</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#GetLatest">func GetLatest() (RuntimeMetrics, []error)</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/gpu_linux.go">gpu_linux.go</a>
			
				<a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go">metrics.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
			
			
			<h2 id="Add">func <a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go#L377">Add</a>
				<a class="permalink" href="#Add">&#xb6;</a>
				
				
			</h2>
			<pre>func Add(metric <a href="https:/docs.whist.com/backend/services/pkg/builtin/#string">string</a>, delta <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>)</pre>
			
			
			

		
			
			
			<h2 id="Close">func <a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go#L367">Close</a>
				<a class="permalink" href="#Close">&#xb6;</a>
				
				
			</h2>
			<pre>func Close()</pre>
			<p>
Close stops the metrics collection goroutine and leaves behind an error for
anyone who attempts to access the metrics after it is called.
</p>

			
			

		
			
			
			<h2 id="Increment">func <a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go#L384">Increment</a>
				<a class="permalink" href="#Increment">&#xb6;</a>
				
				
			</h2>
			<pre>func Increment(metric <a href="https:/docs.whist.com/backend/services/pkg/builtin/#string">string</a>)</pre>
			
			
			

		
		
			
			
			<h2 id="RuntimeMetrics">type <a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go#L30">RuntimeMetrics</a>
				<a class="permalink" href="#RuntimeMetrics">&#xb6;</a>
				
				
			</h2>
			<p>
A RuntimeMetrics groups together several pieces of useful information about
the underlying host.
</p>

			<pre>type RuntimeMetrics struct {

<span id="RuntimeMetrics.TotalMemoryKB"></span>    <span class="comment">// TotalMemoryKB represents the total amount of memory on the host, in KB.</span>
    TotalMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.FreeMemoryKB"></span>    <span class="comment">// FreeMemoryKB represents the amount of currently free memory on the host,</span>
    <span class="comment">// in KB. This is a lower bound for how much more memory we can theoretically</span>
    <span class="comment">// use, since some cached files can be evicted to free up some more memory.</span>
    FreeMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.AvailableMemoryKB"></span>    <span class="comment">// AvailableMemoryKB represents the amount of currently available memory in</span>
    <span class="comment">// the host in KB. This is a hard upper bound for how much more memory we can</span>
    <span class="comment">// use before we start swapping or crash. We should allocate well below this</span>
    <span class="comment">// number because performance will suffer long before we get here.</span>
    AvailableMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.LogicalCPUs"></span>    <span class="comment">// LogicalCPUs represents the number of logical CPUs on the host when the</span>
    <span class="comment">// host service was started.</span>
    LogicalCPUs <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int">int</a>

<span id="RuntimeMetrics.CPUUtilizationPercent"></span>    <span class="comment">// CPUUtilizationPercent represents the percentage of total CPU utilization</span>
    <span class="comment">// across the host system.</span>
    CPUUtilizationPercent <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>

<span id="RuntimeMetrics.NanoCPUsRemaining"></span>    <span class="comment">// NanoCPUsRemaining represents the amount of CPU remaining in units of</span>
    <span class="comment">// (10^-9 CPU). In other words, if two cores are fully idle and all others</span>
    <span class="comment">// are at maximum usage, there&#39;s 2*10^9 NanoCPUsRemaining on that instance.</span>
    NanoCPUsRemaining <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.NumberOfGPUs"></span>    <span class="comment">// NumberOfGPUs represents the number of NVIDIA GPUs on the host system. Note</span>
    <span class="comment">// that for now we assume that all GPUs on an instance are homogeneous.</span>
    NumberOfGPUs <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int">int</a>

<span id="RuntimeMetrics.TotalVideoMemoryKB"></span>    <span class="comment">// TotalVideoMemoryKB represents the amount of video memory in total across</span>
    <span class="comment">// all GPUs on the instance.</span>
    TotalVideoMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.UsedVideoMemoryKB"></span>    <span class="comment">// UsedVideoMemoryKB represents the amount of in-use video memory totaled</span>
    <span class="comment">// across all GPUs on the instance.</span>
    UsedVideoMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.FreeVideoMemoryKB"></span>    <span class="comment">// FreeVideoMemoryKB represents the amount of video memory remaining in</span>
    <span class="comment">// total across all GPUs on the instance.</span>
    FreeVideoMemoryKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

    <span class="comment">// GPUUtilizationPercent represents (an imprecise estimate of) the percentage</span>
    <span class="comment">// of time the GPUs recently spent on GPU kernel computations (this does not</span>
    <span class="comment">// refer to the Linux kernel, but rather kernels that can run on a GPU).</span>
<span id="RuntimeMetrics.GPUKernelUtilizationPercent"></span>    GPUKernelUtilizationPercent <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>

<span id="RuntimeMetrics.GPUMemoryBandwidthUtilizationPercent"></span>    <span class="comment">// GPUMemoryBandwidthUtilizationPercent represents (an imprecise estimate of)</span>
    <span class="comment">// the percentage of time recently when the GPU&#39;s memory was being written</span>
    <span class="comment">// to.</span>
    GPUMemoryBandwidthUtilizationPercent <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>

    <span class="comment">// For an explanation of what these mean, see</span>
    <span class="comment">// https://www.brendangregg.com/blog/2017-08-08/linux-load-averages.html</span>
<span id="RuntimeMetrics.LoadAverage1Min"></span>    LoadAverage1Min  <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>
<span id="RuntimeMetrics.LoadAverage5Min"></span>    LoadAverage5Min  <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>
<span id="RuntimeMetrics.LoadAverage15Min"></span>    LoadAverage15Min <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>

<span id="RuntimeMetrics.DiskTotalKB"></span>    <span class="comment">// DiskTotalKB represents the total amount of SSD space available to the</span>
    <span class="comment">// host.</span>
    DiskTotalKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.DiskUsedKB"></span>    <span class="comment">// DiskUsedKB represents the total amount of SSD space in use on the host.</span>
    DiskUsedKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.DiskFreeKB"></span>    <span class="comment">// DiskFreeKB represents the total amount of SSD space free on the host.</span>
    DiskFreeKB <a href="https:/docs.whist.com/backend/services/pkg/builtin/#uint64">uint64</a>

<span id="RuntimeMetrics.DiskUsedPercent"></span>    <span class="comment">// DiskUsedPercent represents the percentage of disk space used on the host.</span>
    DiskUsedPercent <a href="https:/docs.whist.com/backend/services/pkg/builtin/#float64">float64</a>

<span id="RuntimeMetrics.Uptime"></span>    <span class="comment">// Uptime represents how long the current instance has been up, at a</span>
    <span class="comment">// granularity of one second.</span>
    Uptime <a href="https:/docs.whist.com/backend/services/pkg/time/">time</a>.<a href="https:/docs.whist.com/backend/services/pkg/time/#Duration">Duration</a>

<span id="RuntimeMetrics.TimeStamp"></span>    <span class="comment">// TimeStamp denotes the timestamp when the values in this struct were</span>
    <span class="comment">// collected. This can be used by callers of `GetLatest` to determine how</span>
    <span class="comment">// out-of-date the stats are.</span>
    TimeStamp <a href="https:/docs.whist.com/backend/services/pkg/time/">time</a>.<a href="https:/docs.whist.com/backend/services/pkg/time/#Time">Time</a>

<span id="RuntimeMetrics.AverageRequestTimeMS"></span>    <span class="comment">// AverageRequestTimeMS measures the average time processing an http request.</span>
    AverageRequestTimeMS <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>

<span id="RuntimeMetrics.SuccessfulRequests"></span>    <span class="comment">// SuccessfulRequests counts the number of successfully handled http requests.</span>
    SuccessfulRequests <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>

<span id="RuntimeMetrics.FailedRequests"></span>    <span class="comment">// FailedRequests indicates the number of requests that have failed.</span>
    FailedRequests <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>

<span id="RuntimeMetrics.CleanedStaleMandelboxes"></span>    <span class="comment">// CleanedStaleMandelboxes measures the number of mandelboxes cleaned by the</span>
    <span class="comment">// CleanUpStaleMandelboxes goroutine.</span>
    CleanedStaleMandelboxes <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>

    <span class="comment">// Number of errors in the host service.</span>
<span id="RuntimeMetrics.ErrorRate"></span>    ErrorRate <a href="https:/docs.whist.com/backend/services/pkg/builtin/#int64">int64</a>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="GetLatest">func <a href="https://github.com/whisthq/whist/blob/dev/backend/services/host-service/metrics/metrics.go#L359">GetLatest</a>
					<a class="permalink" href="#GetLatest">&#xb6;</a>
					
					
				</h3>
				<pre>func GetLatest() (<a href="#RuntimeMetrics">RuntimeMetrics</a>, []<a href="https:/docs.whist.com/backend/services/pkg/builtin/#error">error</a>)</pre>
				<p>
GetLatest returns the most recently collected metrics for the host instance,
as well as any errors encountered while collecting those metrics. All
metrics are refreshed at approximately the frequency passed into
StartCollection.
</p>

				
				
			

			
		
	

	







<div id="footer">
Build version go1.17.7.<br>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
