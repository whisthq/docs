<!DOCTYPE html><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#375EAB"/>

  <title>src/github.com/whisthq/whist/backend/services/host-service/dbdriver/doc.go - Whist Backend Services</title>

<link type="text/css" rel="stylesheet" href="https://docs.whist.com/backend/services//lib/godoc/style.css"/>

<script>window.initFuncs = [];</script>
<script src="https://docs.whist.com/backend/services//lib/godoc/jquery.js" defer=""></script>




<script>var goVersion = "go1.17.7";</script>
<script src="https://docs.whist.com/backend/services//lib/godoc/godocs.js" defer=""></script>

</head>
<body>

<div id="lowframe" style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="https:/docs.whist.com/backend/services/pkg/github.com/whisthq/whist/backend/services/">Whist Backend Services | Autogenerated from 9030856</a></div>
<div class="top-heading" id="heading-narrow"><a href="https:/docs.whist.com/backend/services/pkg/github.com/whisthq/whist/backend/services/">Whist Backend Services</a></div>
<a href="#" id="menu-button"><span id="menu-button-arrow">▽</span></a>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Source file
    <a href="https:/docs.whist.com/backend/services/src">src</a>/<a href="https:/docs.whist.com/backend/services/src/github.com">github.com</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq">whisthq</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq/whist">whist</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq/whist/backend">backend</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq/whist/backend/services">services</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq/whist/backend/services/host-service">host-service</a>/<a href="https:/docs.whist.com/backend/services/src/github.com/whisthq/whist/backend/services/host-service/dbdriver">dbdriver</a>/<span class="text-muted">doc.go</span>
  </h1>





  <h2>
    Documentation: <a href="https:/docs.whist.com/backend/services/pkg/github.com/whisthq/whist/backend/services/host-service/dbdriver">github.com/whisthq/whist/backend/services/host-service/dbdriver</a>
  </h2>



<div id="nav"></div>


<script type="text/javascript">document.ANALYSIS_DATA = null;</script>
<pre><span id="L1" class="ln">     1  </span><span class="comment">// Package dbdriver contains the database-interfacing code for the host</span>
<span id="L2" class="ln">     2  </span><span class="comment">// service.</span>
<span id="L3" class="ln">     3  </span><span class="comment">//</span>
<span id="L4" class="ln">     4  </span><span class="comment">// Here we explain some design decisions that went into choosing the tech stack</span>
<span id="L5" class="ln">     5  </span><span class="comment">// for this particular package. Note that these decisions are not at all final,</span>
<span id="L6" class="ln">     6  </span><span class="comment">// but I (@djsavvy) spent quite a while evaluating different technologies and</span>
<span id="L7" class="ln">     7  </span><span class="comment">// therefore want to explain the reasoning behind the decisions that were</span>
<span id="L8" class="ln">     8  </span><span class="comment">// ultimately made for v1 of this package.</span>
<span id="L9" class="ln">     9  </span><span class="comment">//</span>
<span id="L10" class="ln">    10  </span><span class="comment">// Q: Why use `pgx`?</span>
<span id="L11" class="ln">    11  </span><span class="comment">// A: It is blessed by the official Go documentation and is not deprecated.</span>
<span id="L12" class="ln">    12  </span><span class="comment">// It&#39;s also pretty well-documented, especially considering some of the other</span>
<span id="L13" class="ln">    13  </span><span class="comment">// libraries I ran into.</span>
<span id="L14" class="ln">    14  </span><span class="comment">//</span>
<span id="L15" class="ln">    15  </span><span class="comment">// Q: Why not use `gorm`?</span>
<span id="L16" class="ln">    16  </span><span class="comment">// A: Our existing database conventions are quite different from those</span>
<span id="L17" class="ln">    17  </span><span class="comment">// recommened by `gorm`, which means that we would have to write quite a bit of</span>
<span id="L18" class="ln">    18  </span><span class="comment">// boilerplate anyways. It is also slow, and everywhere online that I saw</span>
<span id="L19" class="ln">    19  </span><span class="comment">// mentions of `gorm` I also saw complaints about issues arising when you stray</span>
<span id="L20" class="ln">    20  </span><span class="comment">// off a specific happy path of usage. I also noticed broken english and</span>
<span id="L21" class="ln">    21  </span><span class="comment">// vaguenesses in critical spots of the documentation that led me to believe</span>
<span id="L22" class="ln">    22  </span><span class="comment">// using `gorm` would not actually save any time/effort compared to just</span>
<span id="L23" class="ln">    23  </span><span class="comment">// writing close-to-raw SQL with `pgx`.</span>
<span id="L24" class="ln">    24  </span><span class="comment">//</span>
<span id="L25" class="ln">    25  </span><span class="comment">// Q: Why not use `sqlboiler`?</span>
<span id="L26" class="ln">    26  </span><span class="comment">// A: The idea of generating code based on the schema caught my attention,</span>
<span id="L27" class="ln">    27  </span><span class="comment">// since it would help us ensure that changes to the schema also get reflected</span>
<span id="L28" class="ln">    28  </span><span class="comment">// in the host service code. However, the specific implementation proposed by</span>
<span id="L29" class="ln">    29  </span><span class="comment">// `sqlboiler` isn&#39;t well-suited to our deployment since it would require us to</span>
<span id="L30" class="ln">    30  </span><span class="comment">// spin up a local webserver deployment every time we wanted to build the host</span>
<span id="L31" class="ln">    31  </span><span class="comment">// service. A solution that worked directly with `schema.sql` (which</span>
<span id="L32" class="ln">    32  </span><span class="comment">// `sqlboiler` does not, as far as I can tell) would be ideal. Using</span>
<span id="L33" class="ln">    33  </span><span class="comment">// `sqlboiler` would also require not to use views, which might be a</span>
<span id="L34" class="ln">    34  </span><span class="comment">// dealbreaker down the line.</span>
<span id="L35" class="ln">    35  </span><span class="comment">//</span>
<span id="L36" class="ln">    36  </span><span class="comment">// Q: Why not use `xo`?</span>
<span id="L37" class="ln">    37  </span><span class="comment">// A: This library is interesting for the same reason as `sqlboiler`. However,</span>
<span id="L38" class="ln">    38  </span><span class="comment">// it expects us to use `pq` as the Postgres driver, which is deprecated.</span>
<span id="L39" class="ln">    39  </span><span class="comment">//</span>
<span id="L40" class="ln">    40  </span><span class="comment">// Q: Why use `pgx`&#39;s interface instead of the standard `database/sql` one?  A:</span>
<span id="L41" class="ln">    41  </span><span class="comment">// Honestly I found `pgx`&#39;s interface better-documented. The list of advantages</span>
<span id="L42" class="ln">    42  </span><span class="comment">// at</span>
<span id="L43" class="ln">    43  </span><span class="comment">// https://github.com/JackC/pgx#choosing-between-the-pgx-and-databasesql-interfaces</span>
<span id="L44" class="ln">    44  </span><span class="comment">// also puts some weight on the `pgx` side of the scale. Graceful null value</span>
<span id="L45" class="ln">    45  </span><span class="comment">// handling is particularly useful. Also, being able to use Postgres&#39; native</span>
<span id="L46" class="ln">    46  </span><span class="comment">// notify/listen is likely to come in useful as we move towards a pub/sub</span>
<span id="L47" class="ln">    47  </span><span class="comment">// system.</span>
<span id="L48" class="ln">    48  </span><span class="comment">//</span>
<span id="L49" class="ln">    49  </span><span class="comment">// Q: Why not use `squirrel` or `goqu`?</span>
<span id="L50" class="ln">    50  </span><span class="comment">// A: These SQL builders look quite helpful and pleasant to use. However,</span>
<span id="L51" class="ln">    51  </span><span class="comment">// neither offers a solution to the problem of the DB schema changing from</span>
<span id="L52" class="ln">    52  </span><span class="comment">// under us. We want to make 100% sure that changing the schema also requires</span>
<span id="L53" class="ln">    53  </span><span class="comment">// us to change the relevant code, to prevent issues in production.</span>
<span id="L54" class="ln">    54  </span><span class="comment">//</span>
<span id="L55" class="ln">    55  </span><span class="comment">// Q: Why use `pggen` over `sqlc`?</span>
<span id="L56" class="ln">    56  </span><span class="comment">// A: If you&#39;ve read this far, you know that using the existing `schema.sql`</span>
<span id="L57" class="ln">    57  </span><span class="comment">// file as the single source of truth is a hard requirement. This leaves pretty</span>
<span id="L58" class="ln">    58  </span><span class="comment">// much two options: `pggen` and `sqlc`. While `sqlc` has many more stars on</span>
<span id="L59" class="ln">    59  </span><span class="comment">// Github, `pggen` provides the following advantages:</span>
<span id="L60" class="ln">    60  </span><span class="comment">// - It actually works. `sqlc` was spitting out errors based on our existing</span>
<span id="L61" class="ln">    61  </span><span class="comment">//   `schema.sql`, but since `pggen` uses Postgres to parse the schema it handled</span>
<span id="L62" class="ln">    62  </span><span class="comment">//   it seamlessly. We can also use whatever Postgres extensions we please.</span>
<span id="L63" class="ln">    63  </span><span class="comment">// - `pggen` has significantly better documentation, though it&#39;s less fancy.</span>
<span id="L64" class="ln">    64  </span><span class="comment">// - `pgx` support is very immature in `sqlc` at the time of this writing</span>
<span id="L65" class="ln">    65  </span><span class="comment">//   (merged into master 4 days ago, has not officially been released).</span>
<span id="L66" class="ln">    66  </span><span class="comment">//</span>
<span id="L67" class="ln">    67  </span>package dbdriver <span class="comment">// import &#34;github.com/whisthq/whist/backend/services/host-service/dbdriver&#34;</span>
<span id="L68" class="ln">    68  </span>
</pre><p></p>

<div id="footer">
Build version go1.17.7.<br/>
</div>

</div><!-- .container -->
</div><!-- #page -->


</body></html>